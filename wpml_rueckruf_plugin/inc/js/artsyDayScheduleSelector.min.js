!function(h){"use strict";var s=function(t,e){this.$el=h(t),this.options=h.extend({},s.DEFAULTS,e),this.render(),this.attachEvents(),this.$selectingStart=null};function c(t){return t.is("[data-selected]")}function f(t){var e=t.getHours(),a=t.getMinutes();return("0"+e).slice(-2)+":"+("0"+a).slice(-2)}function d(t){var e=t.split(":")[0],a=t.split(":")[1];return 60*parseInt(e,10)*60+60*parseInt(a,10)}function l(t){var e=Math.floor(t/60);return("0"+Math.floor(e/60)).slice(-2)+":"+("0"+e%60).slice(-2)}s.DEFAULTS={days:[0,1,2,3,4,5,6],startTime:"08:00",endTime:"20:00",interval:30,stringDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],template:'<div class="day-schedule-selector"><table class="schedule-table"><thead class="schedule-header"></thead><tbody class="schedule-rows"></tbody></table><div>'},s.prototype.render=function(){this.$el.html(this.options.template),this.renderHeader(),this.renderRows()},s.prototype.renderHeader=function(){var i=this.options.stringDays,t=this.options.days,s="";h.each(t,function(t,e){var a=i[t].replace(".","");s+='<th id="day'+a+'">'+(i[t]||"")+"</th>"}),this.$el.find(".schedule-header").html("<tr><th></th>"+s+"</tr>")},s.prototype.renderRows=function(){var a,t,i,e,s,n,d=this.options.startTime,l=this.options.endTime,r=this.options.interval,o=this.options.days,y=this.options.stringDays,c=this.$el.find(".schedule-rows");h.each((a=d,t=l,i=r,e=Math.ceil((s=a,n=t,(new Date(2e3,0,1,n.split(":")[0],n.split(":")[1]).getTime()-new Date(2e3,0,1,s.split(":")[0],s.split(":")[1]).getTime())/6e4/i)),h.map(new Array(e),function(t,e){return new Date(new Date(2e3,0,1,a.split(":")[0],a.split(":")[1]).getTime()+e*i*6e4)})),function(t,m){var e,a,i,s=h.map(new Array(o.length),function(t,e){return l=y[e],r=l.split(/\D/),o=(new Date).getFullYear(),c=r[1],h=r[0],6===(u=new Date(o+"-"+c+"-"+h)).getDay()||0===u.getDay()?'<td class="time-slot weekend" data-time="'+f(m)+'" data-day="'+y[e]+'"></td>':(a=y[e],i=a.split(/\D/),s=(new Date).getFullYear(),n=i[1],d=i[0],5===new Date(s+"-"+n+"-"+d).getDay()&&f(m)>blockEndTimeFriday?'<td class="time-slot weekend" data-time="'+f(m)+'" data-day="'+y[e]+'"></td>':'<td class="time-slot" data-time="'+f(m)+'" data-day="'+y[e]+'"></td>');var a,i,s,n,d,l,r,o,c,h,u}).join();c.append('<tr><td class="time-label">'+(a=(e=m).getHours(),i=e.getMinutes(),a+":"+("0"+i).slice(-2))+"</td>"+s+"</tr>")})},s.prototype.isSelecting=function(){return!!this.$selectingStart},s.prototype.select=function(t){t.attr("data-selected","selected")},s.prototype.deselect=function(t){t.removeAttr("data-selected")},s.prototype.masking=function(t){t.addClass("masquerade")},s.prototype.attachEvents=function(){var r,o=this;this.options;this.$el.on("click",".time-slot",function(){if(!h(this).hasClass("weekend")&&!h(this).hasClass("readonly")&&!h(this).hasClass("masquerade")){var t,e,a,i,s,n,d,l=h(this).data("day");o.isSelecting()?(l==o.$selectingStart.data("day")&&("selecting"===r?o.$el.find('.time-slot[data-day="'+l+'"]').filter("[data-selecting]").attr("data-selected","selected").removeAttr("data-selecting"):"deselecting"===r&&o.$el.find('.time-slot[data-day="'+l+'"]').filter("[data-selecting]").removeAttr("data-selected").removeAttr("data-selecting"),o.$el.find(".time-slot").removeAttr("data-disabled"),o.$el.trigger("selected.artsy.dayScheduleSelector",[(t=o,e=o.$selectingStart,a=h(this),e.hasClass("time-slot")&&a.hasClass("time-slot")&&e.data("day")==a.data("day")?(s=(i=t.$el.find('.time-slot[data-day="'+e.data("day")+'"]')).index(e),(n=i.index(a))<s&&(d=s,s=n,n=d),i.slice(s,n+1)):[])]),o.$selectingStart=null),h(".blocklist_save_button").attr("disabled",!1)):(r=c(h(this))?"deselecting":"selecting",o.$selectingStart=h(this),h(this).attr("data-selecting",r),o.$el.find(".time-slot").attr("data-disabled","disabled"),o.$el.find('.time-slot[data-day="'+l+'"]').removeAttr("data-disabled"),h(".blocklist_save_button").attr("disabled",!0))}}),this.$el.on("mouseover",".time-slot",function(){var t,e,a,i,s;if(o.isSelecting()){if(e=o.$selectingStart.data("day"),(t=o.$el.find('.time-slot[data-day="'+e+'"]')).filter("[data-selecting]").removeAttr("data-selecting"),a=t.index(o.$selectingStart),(i=t.index(this))<0)return;i<a&&(s=a,a=i,i=s),t.slice(a,i+1).attr("data-selecting",r)}})},s.prototype.serialize=function(){var s=this,n={};return h.each(this.options.days,function(t,e){var a,i;a=i=!1,n[e]=[],s.$el.find(".time-slot[data-day='"+e+"']").each(function(){c(h(this))&&!a&&(a=h(this).data("time")),!c(h(this))&&a&&(i=h(this).data("time")),c(h(this))&&a&&h(this).is(h(this).closest("tbody").find(".time-slot[data-day='"+e+"']:last"))&&(i=l(d(h(this).data("time"))+60*s.options.interval)),i&&(n[e].push([a,i]),a=i=!1)})}),n},s.prototype.deserialize=function(t){var i,s=this;h.each(t,function(t,e){var a=s.$el.find('.time-slot[data-day="'+t+'"]');h.each(e,function(t,e){for(i=0;i<a.length&&!(a.eq(i).data("time")>=e[1]);i++)a.eq(i).data("time")>=e[0]&&s.select(a.eq(i))})})},s.prototype.masquerade=function(t){var i,s=this;h.each(t,function(t,e){var a=s.$el.find('.time-slot[data-day="'+t+'"]');h.each(e,function(t,e){for(i=0;i<a.length&&!(a.eq(i).data("time")>=e[1]);i++)a.eq(i).data("time")>=e[0]&&s.masking(a.eq(i))})})},h.fn.dayScheduleSelector=function(i){return this.each(function(){var t=h(this),e=t.data("artsy.dayScheduleSelector"),a="object"==typeof i&&i;e||t.data("artsy.dayScheduleSelector",e=new s(this,a))})},window.DayScheduleSelector={ssmToHhmm:l,hhmmToSsm:d}}(jQuery);